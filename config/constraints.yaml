# constraints.yaml
# Canonical source for all Theater Pipeline constraints
# All agents and skills should reference this file

version: "2.0"
last_updated: "2026-01-08"
pipeline: "theater_education"

# =============================================================================
# DAILY STRUCTURE (56 minutes total)
# =============================================================================

daily_structure:
  total_minutes: 56

  components:
    agenda_journal:
      duration_minutes: 5
      tolerance_seconds: 30
      description: "Agenda display and journal-in prompt"

    warmup:
      duration_minutes: 5
      tolerance_seconds: 30
      description: "Content-connected theater warmup"

    lecture:
      duration_minutes: 15
      min_duration_minutes: 5   # HARDCODED minimum
      max_duration_minutes: 20  # HARDCODED maximum
      tolerance_minutes: 1
      description: "PowerPoint presentation with verbatim notes"
      frontloading_required: true  # Lecture MUST frontload activity content

    activity:
      duration_minutes: 15
      tolerance_minutes: 1
      description: "Structured hands-on activity"

    reflection:
      duration_minutes: 10
      tolerance_minutes: 1
      description: "Journal reflection and exit ticket"

    buffer:
      duration_minutes: 6
      description: "Transition and flexibility time"

# =============================================================================
# TEXT LIMITS
# =============================================================================

text_limits:
  # Header/Title Constraints
  header:
    chars_per_line: 36
    max_lines: 1
    total_max_chars: 36
    revision_required: true  # NEVER truncate - always revise to fit

  # Body Constraints
  body:
    max_lines: 12
    word_wrap: true
    truncation: false  # NEVER truncate body content

  # Performance Tip Constraints
  performance_tip:
    chars_per_line: 66
    max_lines: 2
    total_max_chars: 132
    prefix: "PERFORMANCE TIP:"

# =============================================================================
# PRESENTER NOTES REQUIREMENTS (15-minute verbatim script)
# =============================================================================

presenter_notes:
  # Word count targets for 15 minutes at 130-150 WPM
  total_words:
    minimum: 1950
    target: 2100
    maximum: 2250

  # Per-slide targets (12 content slides)
  per_slide:
    minimum: 100
    target_low: 160
    target_high: 190
    maximum: 250

  # Duration estimates
  duration:
    target_minutes: 15
    minimum_minutes: 14
    maximum_minutes: 16
    speaking_rate_wpm: 140  # Average speaking rate

  # Required markers
  markers:
    pause:
      min_per_slide: 2
      format: "[PAUSE]"
    emphasis:
      min_per_content_slide: 1
      format: "[EMPHASIS: term]"
    check_understanding:
      min_per_presentation: 3
      format: "[CHECK FOR UNDERSTANDING]"

  # Style requirements
  style:
    verbatim: true  # Word-for-word script
    contractions_allowed: true
    direct_address: true  # "you", "we", "let's"
    natural_spoken_language: true

# =============================================================================
# WARMUP REQUIREMENTS
# =============================================================================

warmup:
  duration_minutes: 5

  # Structure requirements
  structure:
    required_phases:
      - setup           # 30 seconds
      - demonstration   # 30 seconds (if needed)
      - execution       # 3 minutes
      - wrapup          # 30 seconds
      - transition      # 30 seconds

  # Content requirements
  content:
    must_connect_to_lesson: true
    abstract_allowed: false

    # Must include at least one of:
    connection_types:
      - vocabulary_reference
      - skill_practice
      - concept_preview

  # Types by category
  types:
    physical: ["voice", "body", "movement"]
    mental: ["focus", "observation", "concentration"]
    social: ["partner", "group", "ensemble"]
    creative: ["improvisation", "imagination"]
    content: ["skill_practice", "vocabulary"]

# =============================================================================
# ACTIVITY REQUIREMENTS
# =============================================================================

activity:
  duration_minutes: 15

  # Structure requirements
  structure:
    setup_minutes: 1.5
    work_minutes: 11
    sharing_minutes: 2.5

    required_elements:
      - numbered_steps
      - time_allocations
      - expected_outcomes
      - teacher_actions
      - student_actions

  # Time warnings
  time_warnings:
    - at_minute: 10
    - at_minute: 13

  # Types allowed
  types:
    - writing
    - discussion
    - performance
    - annotation
    - creative
    - physical
    - collaborative

  # Differentiation required
  differentiation:
    required_categories:
      - ell_supports
      - advanced_extensions
      - struggling_modifications

# =============================================================================
# POWERPOINT STRUCTURE
# =============================================================================

powerpoint:
  # Slide counts
  slides:
    content_slides: 12
    auxiliary_slides: 4
    total_slides: 16

  # Slide structure
  structure:
    - slide: 1
      type: "auxiliary"
      content: "Agenda"
      counted: false
    - slide: 2
      type: "auxiliary"
      content: "Warmup Instructions"
      counted: false
    - slides: "3-14"
      type: "content"
      content: "Learning Content"
      counted: true
      count: 12
    - slide: 15
      type: "auxiliary"
      content: "Activity Instructions"
      counted: false
    - slide: 16
      type: "auxiliary"
      content: "Journal & Exit Ticket"
      counted: false

# =============================================================================
# MARKER REQUIREMENTS
# =============================================================================

markers:
  pause:
    min_per_slide: 2
    format: "[PAUSE]"
    alternate_formats:
      - "[PAUSE - X seconds]"

  emphasis:
    min_per_content_slide: 1
    format: "[EMPHASIS: term]"

  check_understanding:
    min_per_presentation: 3
    format: "[CHECK FOR UNDERSTANDING]"

  performance_callout:
    required: false
    patterns:
      - "In performance"
      - "On stage"
      - "When you're performing"

# =============================================================================
# VALIDATION THRESHOLDS (HARDCODED VALIDATORS)
# =============================================================================

validation:
  # Truncation Validator (HARDCODED - CANNOT BE BYPASSED)
  truncation:
    rules:
      - "Every sentence must end with . ! ? or :"
      - "No trailing ellipsis (...)"
      - "No mid-word cuts"
      - "No incomplete thoughts"
    auto_fix: true
    must_pass: true

  # Elaboration Validator (HARDCODED - CANNOT BE BYPASSED)
  elaboration:
    pass_threshold: 85  # Out of 100
    scoring_weights:
      depth: 0.30
      examples: 0.20
      procedure: 0.20
      tone: 0.15
      connections: 0.15
    must_pass: true

  # Timing Validator (HARDCODED - CANNOT BE BYPASSED)
  timing:
    presenter_notes:
      min_words: 1950
      max_words: 3000  # Temporarily relaxed for Shakespeare unit
      min_minutes: 14
      max_minutes: 22  # Temporarily relaxed for Shakespeare unit
    per_slide:
      min_words: 50
      max_words: 300
    must_pass: true

  # Structure Validator (HARDCODED - CANNOT BE BYPASSED)
  structure:
    required_components:
      - lesson_plan
      - powerpoint
      - presenter_notes
      - warmup
      - activity
      - handout
      - journal_prompt
      - exit_tickets
      - standards
      - materials_list
    must_pass: true

# =============================================================================
# QUALITY GATE THRESHOLDS
# =============================================================================

quality_gates:
  # Gate 1: Post-Generation (MANDATORY)
  gate_1:
    name: "Post-Generation"
    validators:
      - truncation  # MUST PASS
      - structure   # MUST PASS
    action_on_fail: "return_to_generation"

  # Gate 2: Quality (Score-Based)
  gate_2:
    name: "Quality"
    validators:
      - elaboration: 85  # Score >= 85
      - timing: "within_tolerance"
      - coherence: 80
    action_on_fail: "return_to_revision"

  # Gate 3: Standards (Coverage)
  gate_3:
    name: "Standards"
    validators:
      - standards_coverage: "all_objectives_linked"
      - pedagogy: 80
    action_on_fail: "return_to_revision"

# =============================================================================
# LEARNING OBJECTIVE COVERAGE
# =============================================================================

learning_objective_coverage:
  required_rate: 1.0  # 100% coverage required
  max_objectives_per_slide: 2
  min_objectives_per_lesson: 2
  max_objectives_per_lesson: 4

  # Each objective must be:
  requirements:
    - addressed_in_lecture: true
    - practiced_in_activity: true
    - assessed_in_exit_ticket: true

# =============================================================================
# LESSON PLAN REQUIREMENTS
# =============================================================================

lesson_plan:
  # Required sections
  required_sections:
    - basic_information
    - standards
    - learning_objectives
    - vocabulary
    - materials
    - procedure
    - differentiation
    - assessment
    - reflection_space

  # Procedure must include
  procedure_requirements:
    - teacher_actions
    - student_actions
    - timing_per_component
    - transitions

  # Differentiation must address
  differentiation_categories:
    - ell_support
    - advanced_learners
    - struggling_learners

# =============================================================================
# UNIT STRUCTURE
# =============================================================================

units:
  total_units: 4
  total_instructional_days: 80

  unit_list:
    - number: 1
      name: "Greek Theater"
      days: 20
      focus: ["origins", "tragedy", "comedy", "chorus", "masks"]

    - number: 2
      name: "Commedia dell'Arte"
      days: 18
      focus: ["stock_characters", "lazzi", "improvisation", "physicality"]

    - number: 3
      name: "Shakespeare"
      days: 30  # Updated for Romeo and Juliet full coverage
      focus: ["language", "verse", "staging", "character_analysis", "romeo_and_juliet"]

    - number: 4
      name: "Student-Directed One Acts"
      days: 17
      focus: ["directing", "blocking", "rehearsal", "production"]

# =============================================================================
# ROMEO AND JULIET 6-WEEK UNIT (HARDCODED)
# =============================================================================

romeo_and_juliet:
  total_weeks: 6
  total_days: 30  # 5 days per week
  text: "Romeo and Juliet by William Shakespeare"

  # Coverage structure by act
  coverage:
    week_1:
      act: 1
      days: 5
      focus:
        - "Prologue and exposition"
        - "Act 1 Scene 1: Street brawl"
        - "Act 1 Scene 2-3: Ball preparations"
        - "Act 1 Scene 4: Queen Mab speech"
        - "Act 1 Scene 5: The ball and meeting"
      reading_required: true
      reading_type: "shared_reading_with_annotation"

    week_2:
      act: 2
      days: 5
      focus:
        - "Act 2 Scene 1: After the ball"
        - "Act 2 Scene 2: Balcony scene (Part 1)"
        - "Act 2 Scene 2: Balcony scene (Part 2)"
        - "Act 2 Scene 3-4: Friar Lawrence and Nurse"
        - "Act 2 Scene 5-6: Marriage"
      reading_required: true
      reading_type: "close_reading_with_discussion"

    week_3:
      act: 3
      days: 6
      focus:
        - "Act 3 Scene 1: Mercutio and Tybalt fight"
        - "Act 3 Scene 1: Romeo kills Tybalt"
        - "Act 3 Scene 2: Juliet learns news"
        - "Act 3 Scene 3: Romeo's banishment"
        - "Act 3 Scene 4-5: Capulet's ultimatum"
        - "Act 3 Scene 5: Juliet's farewell"
      reading_required: true
      reading_type: "partner_reading_with_roles"

    week_4:
      act: 4
      days: 5
      focus:
        - "Act 4 Scene 1: Friar's plan"
        - "Act 4 Scene 2-3: Juliet's decision"
        - "Act 4 Scene 3: Potion soliloquy"
        - "Act 4 Scene 4-5: Discovery"
        - "Act 4 Review and analysis"
      reading_required: true
      reading_type: "independent_reading_with_response"

    week_5:
      act: 5
      days: 5
      focus:
        - "Act 5 Scene 1: Romeo in Mantua"
        - "Act 5 Scene 2: Friar John's failure"
        - "Act 5 Scene 3: Tomb scene (Part 1)"
        - "Act 5 Scene 3: Deaths and resolution"
        - "Full play review and themes"
      reading_required: true
      reading_type: "choral_reading_for_verse"

    week_6:
      act: "performance"
      days: 4
      focus:
        - "Scene selection and rehearsal"
        - "Scene blocking and staging"
        - "Final rehearsal"
        - "Scene performances"
      reading_required: false
      reading_type: null

  # Required reading activities
  reading_activities:
    - name: "Shared Reading with Annotation"
      description: "Teacher reads aloud while students follow with text annotations"
      duration_minutes: 10
      supports: ["vocabulary preview", "modern translation", "character chart"]

    - name: "Close Reading with Discussion"
      description: "Focused reading of key passages with guided discussion"
      duration_minutes: 12
      supports: ["guiding questions", "annotation guide", "partner discussion"]

    - name: "Partner Reading with Roles"
      description: "Students read aloud in pairs, switching roles"
      duration_minutes: 10
      supports: ["role cards", "pronunciation guide", "character motivation"]

    - name: "Independent Reading with Response"
      description: "Silent reading followed by written response"
      duration_minutes: 8
      supports: ["reading guide", "response prompts", "vocabulary glossary"]

    - name: "Choral Reading for Verse"
      description: "Whole class reads verse passages in unison"
      duration_minutes: 5
      supports: ["rhythm guide", "emphasis markers", "verse structure"]

    - name: "Readers Theater Performance"
      description: "Dramatic reading with assigned parts"
      duration_minutes: 15
      supports: ["script excerpts", "character blocking", "vocal coaching"]

# =============================================================================
# INSTRUCTIONAL FRAMEWORKS (HARDCODED)
# =============================================================================

instructional_frameworks:
  # Scaffolding requirements
  scaffolding:
    min_scaffolds_per_lesson: 2
    max_scaffolds_per_lesson: 4
    required_progression: "high_to_low_support"  # Modeled -> Guided -> Collaborative -> Independent
    gradual_release_model: true  # I Do, We Do, You Do

  # Formative assessment requirements
  formative_assessment:
    min_checks_per_lesson: 2
    max_checks_per_lesson: 5
    variety_required: true  # Must use different types
    objective_alignment_required: true

  # Bloom's Taxonomy requirements
  blooms_taxonomy:
    min_levels_per_lesson: 3
    required_lower_order: 1  # At least 1 Remember/Understand/Apply
    required_higher_order: 1  # At least 1 Analyze/Evaluate/Create
    progression_required: true  # Lower before higher

  # Webb's DOK requirements
  webbs_dok:
    min_levels_per_lesson: 2
    foundation_required: true  # DOK 1-2 before DOK 3-4
    extended_encouraged: true  # DOK 4 when time allows

  # Lecture frontloading
  lecture_frontloading:
    required: true
    must_introduce_vocabulary: true
    must_connect_to_activity: true
    min_duration_minutes: 5
    max_duration_minutes: 20

# =============================================================================
# CALIFORNIA STANDARDS ALIGNMENT
# =============================================================================

standards:
  framework: "California Common Core"
  grade_levels: ["9-10", "11-12"]

  required_domains:
    - code_prefix: "RL"
      name: "Reading Literature"
      min_per_lesson: 1
    - code_prefix: "SL"
      name: "Speaking & Listening"
      min_per_lesson: 1
    - code_prefix: "W"
      name: "Writing"
      min_per_lesson: 0  # Optional

  format:
    include_full_text: true  # Not just codes
    example: "RL.9-10.3: Analyze how complex characters develop..."
